<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investie - Psychology & Mental Health Investment Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .tab-btn.active {
            background: white;
            color: #667eea;
            font-weight: bold;
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .result-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #667eea;
        }

        .result-card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-item strong {
            color: #333;
        }

        .result-item .value {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
        }

        .portfolio-list {
            margin-top: 20px;
        }

        .portfolio-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .portfolio-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .portfolio-item h3 {
            color: #333;
            margin: 0;
        }

        .portfolio-item .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .portfolio-item .delete-btn:hover {
            background: #c82333;
        }

        .portfolio-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-box .label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-box .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-box .value.positive {
            color: #28a745;
        }

        .stat-box .value.negative {
            color: #dc3545;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #dc3545;
        }

        .stock-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .info-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .info-card .label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .info-card .value {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .recommended-stocks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stock-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stock-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .stock-card .symbol {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 8px;
        }

        .stock-card .name {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 12px;
        }

        .stock-card .price {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .stock-card .change {
            font-size: 0.9em;
        }

        .stock-chart {
            width: 100%;
            height: 80px;
            margin-top: 15px;
            position: relative;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 6px;
            padding: 5px;
        }

        .chart-canvas {
            width: 100%;
            height: 100%;
        }

        .auto-update-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #28a745;
            margin-left: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .live-badge {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            margin-left: 10px;
            animation: pulse 2s infinite;
        }

        .market-overview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .market-overview h3 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .market-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .market-stat {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .market-stat .label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .market-stat .value {
            font-size: 1.5em;
            font-weight: bold;
        }

        .stock-card .change.positive {
            color: #28a745;
        }

        .stock-card .change.negative {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§  Investie</h1>
            <p>Psychology & Mental Health Investment Tracker - ì‹¬ë¦¬í•™Â·ì •ì‹ ê±´ê°• íˆ¬ì ì¶”ì ê¸°</p>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('calculator')">íˆ¬ì ê³„ì‚°ê¸°</button>
            <button class="tab-btn" onclick="showTab('portfolio')">í¬íŠ¸í´ë¦¬ì˜¤</button>
            <button class="tab-btn" onclick="showTab('stock')">ì£¼ì‹ ì¡°íšŒ</button>
            <button class="tab-btn" onclick="showTab('exchange')">í™˜ìœ¨ ì¡°íšŒ</button>
        </div>

        <!-- íˆ¬ì ê³„ì‚°ê¸° íƒ­ -->
        <div id="calculator" class="tab-content active">
            <h2>íˆ¬ì ìˆ˜ìµë¥  ê³„ì‚°ê¸°</h2>
            <form id="calculatorForm">
                <div class="form-group">
                    <label>íˆ¬ì ê¸ˆì•¡ (ì›)</label>
                    <input type="number" id="investmentAmount" placeholder="ì˜ˆ: 1000000" required>
                </div>
                <div class="form-group">
                    <label>í˜„ì¬ ê°€ì¹˜ (ì›)</label>
                    <input type="number" id="currentValue" placeholder="ì˜ˆ: 1200000" required>
                </div>
                <div class="form-group">
                    <label>íˆ¬ì ê¸°ê°„ (ì¼)</label>
                    <input type="number" id="investmentDays" placeholder="ì˜ˆ: 365" required>
                </div>
                <button type="submit" class="btn">ê³„ì‚°í•˜ê¸°</button>
            </form>
            <div id="calculatorResult"></div>
            
            <!-- ì‹œì¥ ê°œìš” -->
            <div class="market-overview" id="marketOverview" style="display: none;">
                <h3>ğŸ“ˆ ì‹¤ì‹œê°„ ì‹œì¥ ê°œìš” <span class="live-badge">LIVE</span></h3>
                <div class="market-stats">
                    <div class="market-stat">
                        <div class="label">í‰ê·  ë³€ë™ë¥ </div>
                        <div class="value" id="avgChange">-</div>
                    </div>
                    <div class="market-stat">
                        <div class="label">ìƒìŠ¹ ì¢…ëª©</div>
                        <div class="value" id="gainers">-</div>
                    </div>
                    <div class="market-stat">
                        <div class="label">í•˜ë½ ì¢…ëª©</div>
                        <div class="value" id="losers">-</div>
                    </div>
                    <div class="market-stat">
                        <div class="label">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸</div>
                        <div class="value" id="lastUpdate" style="font-size: 1em;">-</div>
                    </div>
                </div>
            </div>

            <!-- íˆ¬ì ì¸ì‚¬ì´íŠ¸ -->
            <div style="margin-top: 40px;">
                <h2 style="margin-bottom: 20px;">ğŸ’¡ íˆ¬ì ì¸ì‚¬ì´íŠ¸ & ì‹œì¥ íŠ¸ë Œë“œ</h2>
                <div id="investmentInsights" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px;">
                        <h3 style="margin-bottom: 10px; font-size: 1.2em;">ğŸ“ˆ ì‹œì¥ íŠ¸ë Œë“œ</h3>
                        <p style="opacity: 0.9; line-height: 1.6;">
                            ì‹¬ë¦¬í•™Â·ì •ì‹ ê±´ê°• ì„¹í„°ëŠ” ì§€ì†ì ì¸ ì„±ì¥ì„¸ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤. 
                            ë””ì§€í„¸ í—¬ìŠ¤ì¼€ì–´ì™€ ì›ê²© ì¹˜ë£Œ ì„œë¹„ìŠ¤ì˜ í™•ì‚°ìœ¼ë¡œ ê´€ë ¨ ê¸°ì—…ë“¤ì˜ ì„±ì¥ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.
                        </p>
                    </div>
                    <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 12px;">
                        <h3 style="margin-bottom: 10px; font-size: 1.2em;">âš–ï¸ í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„± ê°€ì´ë“œ</h3>
                        <p style="opacity: 0.9; line-height: 1.6;">
                            <strong>ê¶Œì¥ ë¹„ì¤‘:</strong><br>
                            â€¢ ëŒ€í˜• ì œì•½ì‚¬ (JNJ, PFE): 40%<br>
                            â€¢ ë””ì§€í„¸ í—¬ìŠ¤ (TDOC): 30%<br>
                            â€¢ ë°”ì´ì˜¤í… (BIIB, ABBV): 30%
                        </p>
                    </div>
                    <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 12px;">
                        <h3 style="margin-bottom: 10px; font-size: 1.2em;">âš ï¸ ë¦¬ìŠ¤í¬ ê´€ë¦¬</h3>
                        <p style="opacity: 0.9; line-height: 1.6;">
                            â€¢ ê·œì œ ë¦¬ìŠ¤í¬: FDA ìŠ¹ì¸ ì§€ì—° ê°€ëŠ¥ì„±<br>
                            â€¢ ì‹œì¥ ë³€ë™ì„±: ë†’ì€ ë³€ë™ì„± ëŒ€ë¹„ ì¶©ë¶„í•œ í˜„ê¸ˆ ë³´ìœ <br>
                            â€¢ ë¶„ì‚° íˆ¬ì: ë‹¨ì¼ ì¢…ëª© ì§‘ì¤‘ íˆ¬ì ì§€ì–‘
                        </p>
                    </div>
                </div>
                
                <h2 style="margin-bottom: 20px;">
                    ğŸ“Š ì‹œì¥ í˜„í™© ìš”ì•½ 
                    <span class="auto-update-indicator" id="updateIndicator"></span>
                    <span style="font-size: 0.7em; color: #666; font-weight: normal;">(30ì´ˆë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸)</span>
                </h2>
                <div id="recommendedStocks" class="recommended-stocks-grid">
                    <div class="loading"><div class="spinner"></div>ì£¼ì‹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>
        </div>

        <!-- í¬íŠ¸í´ë¦¬ì˜¤ íƒ­ -->
        <div id="portfolio" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">ë‚´ í¬íŠ¸í´ë¦¬ì˜¤</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="btn" onclick="updateAllPrices()" style="background: #28a745;">ğŸ”„ ì „ì²´ ê°€ê²© ì—…ë°ì´íŠ¸</button>
                    <button class="btn" onclick="sortPortfolio('profit')" style="background: #667eea;">ğŸ“Š ìˆ˜ìµë¥ ìˆœ ì •ë ¬</button>
                </div>
            </div>
            
            <form id="portfolioForm">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div class="form-group">
                        <label>ì¢…ëª©ëª…/ì‹¬ë³¼</label>
                        <input type="text" id="portfolioName" placeholder="ì˜ˆ: JNJ ë˜ëŠ” ì¡´ìŠ¨ì•¤ì¡´ìŠ¨" required>
                    </div>
                    <div class="form-group">
                        <label>ë§¤ìˆ˜ ê°€ê²© (ì›)</label>
                        <input type="number" id="portfolioBuyPrice" placeholder="ì˜ˆ: 70000" required>
                    </div>
                    <div class="form-group">
                        <label>ë§¤ìˆ˜ ìˆ˜ëŸ‰</label>
                        <input type="number" id="portfolioQuantity" placeholder="ì˜ˆ: 10" required>
                    </div>
                    <div class="form-group">
                        <label>í˜„ì¬ ê°€ê²© (ì›)</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="number" id="portfolioCurrentPrice" placeholder="ìë™ ì¡°íšŒ ë˜ëŠ” ìˆ˜ë™ ì…ë ¥" style="flex: 1;">
                            <button type="button" class="btn" onclick="autoFetchPrice()" style="background: #17a2b8; padding: 12px 15px;">ğŸ” ì¡°íšŒ</button>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn" id="portfolioSubmitBtn">í¬íŠ¸í´ë¦¬ì˜¤ì— ì¶”ê°€</button>
            </form>
            
            <!-- í¬íŠ¸í´ë¦¬ì˜¤ í•„í„° ë° ì •ë ¬ -->
            <div style="margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                <label style="font-weight: 600;">ì •ë ¬:</label>
                <button class="btn" onclick="sortPortfolio('name')" style="background: #6c757d; padding: 8px 15px; font-size: 0.9em;">ì´ë¦„ìˆœ</button>
                <button class="btn" onclick="sortPortfolio('profit')" style="background: #6c757d; padding: 8px 15px; font-size: 0.9em;">ìˆ˜ìµë¥ ìˆœ</button>
                <button class="btn" onclick="sortPortfolio('profitAmount')" style="background: #6c757d; padding: 8px 15px; font-size: 0.9em;">ì†ìµìˆœ</button>
                <button class="btn" onclick="sortPortfolio('value')" style="background: #6c757d; padding: 8px 15px; font-size: 0.9em;">ê°€ì¹˜ìˆœ</button>
                <label style="font-weight: 600; margin-left: 20px;">í•„í„°:</label>
                <button class="btn" onclick="filterPortfolio('all')" style="background: #6c757d; padding: 8px 15px; font-size: 0.9em;">ì „ì²´</button>
                <button class="btn" onclick="filterPortfolio('profit')" style="background: #28a745; padding: 8px 15px; font-size: 0.9em;">ìˆ˜ìµ</button>
                <button class="btn" onclick="filterPortfolio('loss')" style="background: #dc3545; padding: 8px 15px; font-size: 0.9em;">ì†ì‹¤</button>
            </div>
            
            <div id="portfolioList" class="portfolio-list"></div>
        </div>

        <!-- ì£¼ì‹ ì¡°íšŒ íƒ­ -->
        <div id="stock" class="tab-content">
            <h2>ì‹¬ë¦¬í•™Â·ì •ì‹ ê±´ê°• ê´€ë ¨ ì£¼ì‹ ì¡°íšŒ</h2>
            
            <!-- ë¹ ë¥¸ ì¡°íšŒ -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h3 style="margin-bottom: 15px; color: #667eea;">âš¡ ë¹ ë¥¸ ì¡°íšŒ</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn" onclick="quickStockLookup('JNJ')" style="background: #667eea;">JNJ</button>
                    <button class="btn" onclick="quickStockLookup('PFE')" style="background: #667eea;">PFE</button>
                    <button class="btn" onclick="quickStockLookup('ABBV')" style="background: #667eea;">ABBV</button>
                    <button class="btn" onclick="quickStockLookup('TDOC')" style="background: #667eea;">TDOC</button>
                    <button class="btn" onclick="quickStockLookup('CVS')" style="background: #667eea;">CVS</button>
                    <button class="btn" onclick="quickStockLookup('BIIB')" style="background: #667eea;">BIIB</button>
                    <button class="btn" onclick="quickStockLookup('NVS')" style="background: #667eea;">NVS</button>
                </div>
            </div>
            
            <form id="stockForm">
                <div class="form-group">
                    <label>ì¢…ëª© ì‹¬ë³¼ (ì—¬ëŸ¬ ì¢…ëª©ì€ ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                    <input type="text" id="stockSymbol" placeholder="ì˜ˆ: JNJ ë˜ëŠ” JNJ,PFE,TDOC" required>
                    <small style="color: #666; margin-top: 5px; display: block;">
                        ì¶”ì²œ ì¢…ëª©: JNJ(ì¡´ìŠ¨ì•¤ì¡´ìŠ¨), PFE(í™”ì´ì), ABBV(ì• ë¸Œë¹„), TDOC(í…”ë¼ë…), CVS(CVSí—¬ìŠ¤), BIIB(ë°”ì´ì˜¤ì  ), NVS(ë…¸ë°”í‹°ìŠ¤) ë“±
                        <br>ì—¬ëŸ¬ ì¢…ëª©ì„ ë™ì‹œì— ì¡°íšŒí•˜ë ¤ë©´ ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì„¸ìš” (ì˜ˆ: JNJ,PFE,TDOC)
                    </small>
                </div>
                <button type="submit" class="btn">ì¡°íšŒí•˜ê¸°</button>
            </form>
            
            <!-- ì¦ê²¨ì°¾ê¸° -->
            <div style="margin-top: 20px; background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                <h4 style="margin-bottom: 10px;">â­ ì¦ê²¨ì°¾ê¸° ì¢…ëª©</h4>
                <div id="favoriteStocks" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
            </div>
            
            <div id="stockResult" style="margin-top: 20px;"></div>
            
            <!-- ë¹„êµ í…Œì´ë¸” -->
            <div id="comparisonTable" style="margin-top: 30px; display: none;">
                <h3 style="margin-bottom: 15px;">ğŸ“Š ì¢…ëª© ë¹„êµ</h3>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px;">
                        <thead>
                            <tr style="background: #667eea; color: white;">
                                <th style="padding: 12px; text-align: left;">ì¢…ëª©</th>
                                <th style="padding: 12px; text-align: right;">í˜„ì¬ê°€</th>
                                <th style="padding: 12px; text-align: right;">ë³€ë™</th>
                                <th style="padding: 12px; text-align: right;">ë³€ë™ë¥ </th>
                                <th style="padding: 12px; text-align: center;">ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="comparisonTableBody"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- ì¢…ëª© ë¹„êµ ë¶„ì„ -->
            <div style="margin-top: 40px;">
                <h2 style="margin-bottom: 20px;">ğŸ“Š ì¢…ëª© ë¹„êµ ë¶„ì„</h2>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px; color: #667eea;">ğŸ’¡ íˆ¬ì ì „ëµ ê°€ì´ë“œ</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;">
                            <strong style="color: #28a745;">ğŸŸ¢ ì•ˆì •í˜•</strong>
                            <p style="margin-top: 8px; color: #666; font-size: 0.9em;">
                                JNJ, PFE, CVS<br>
                                ë‚®ì€ ë³€ë™ì„±, ì•ˆì •ì  ë°°ë‹¹
                            </p>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                            <strong style="color: #ffc107;">ğŸŸ¡ ì„±ì¥í˜•</strong>
                            <p style="margin-top: 8px; color: #666; font-size: 0.9em;">
                                TDOC, ABBV<br>
                                ë†’ì€ ì„±ì¥ ì ì¬ë ¥
                            </p>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #dc3545;">
                            <strong style="color: #dc3545;">ğŸ”´ ê³µê²©í˜•</strong>
                            <p style="margin-top: 8px; color: #666; font-size: 0.9em;">
                                BIIB<br>
                                ë†’ì€ ë³€ë™ì„±, ë†’ì€ ìˆ˜ìµ ê°€ëŠ¥ì„±
                            </p>
                        </div>
                    </div>
                </div>
                
                <h3 style="margin-bottom: 15px; color: #333;">ğŸ” ì¶”ì²œ ì¢…ëª© ìƒì„¸ ë¶„ì„</h3>
                <div id="previewStocks" class="recommended-stocks-grid">
                    <div class="loading"><div class="spinner"></div>ì£¼ì‹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>
        </div>

        <!-- í™˜ìœ¨ ì¡°íšŒ íƒ­ -->
        <div id="exchange" class="tab-content">
            <h2>í™˜ìœ¨ ì¡°íšŒ</h2>
            <form id="exchangeForm">
                <div class="form-group">
                    <label>ê¸°ì¤€ í†µí™”</label>
                    <select id="fromCurrency">
                        <option value="KRW">KRW (ì›)</option>
                        <option value="USD">USD (ë‹¬ëŸ¬)</option>
                        <option value="EUR">EUR (ìœ ë¡œ)</option>
                        <option value="JPY">JPY (ì—”)</option>
                        <option value="CNY">CNY (ìœ„ì•ˆ)</option>
                        <option value="GBP">GBP (íŒŒìš´ë“œ)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ë³€í™˜ í†µí™”</label>
                    <select id="toCurrency">
                        <option value="USD">USD (ë‹¬ëŸ¬)</option>
                        <option value="KRW">KRW (ì›)</option>
                        <option value="EUR">EUR (ìœ ë¡œ)</option>
                        <option value="JPY">JPY (ì—”)</option>
                        <option value="CNY">CNY (ìœ„ì•ˆ)</option>
                        <option value="GBP">GBP (íŒŒìš´ë“œ)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ê¸ˆì•¡</label>
                    <input type="number" id="exchangeAmount" placeholder="ì˜ˆ: 1000" value="1" required>
                </div>
                <button type="submit" class="btn">í™˜ìœ¨ ì¡°íšŒ</button>
            </form>
            <div id="exchangeResult"></div>
        </div>
    </div>

    <script>
        // íƒ­ ì „í™˜
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // ì£¼ì‹ ì¡°íšŒ íƒ­ìœ¼ë¡œ ì „í™˜ ì‹œ ë¯¸ë¦¬ë³´ê¸° ë¡œë“œ
            if (tabName === 'stock') {
                loadPreviewStocks();
            }
        }

        // íˆ¬ì ê³„ì‚°ê¸°
        document.getElementById('calculatorForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const amount = parseFloat(document.getElementById('investmentAmount').value);
            const current = parseFloat(document.getElementById('currentValue').value);
            const days = parseFloat(document.getElementById('investmentDays').value);

            const profit = current - amount;
            const profitRate = ((current - amount) / amount) * 100;
            const annualRate = (profitRate / days) * 365;

            const resultDiv = document.getElementById('calculatorResult');
            resultDiv.innerHTML = `
                <div class="result-card">
                    <h3>ê³„ì‚° ê²°ê³¼</h3>
                    <div class="result-item">
                        <strong>íˆ¬ì ê¸ˆì•¡:</strong>
                        <span class="value">${amount.toLocaleString()}ì›</span>
                    </div>
                    <div class="result-item">
                        <strong>í˜„ì¬ ê°€ì¹˜:</strong>
                        <span class="value">${current.toLocaleString()}ì›</span>
                    </div>
                    <div class="result-item">
                        <strong>ì†ìµ:</strong>
                        <span class="value ${profit >= 0 ? 'positive' : 'negative'}">
                            ${profit >= 0 ? '+' : ''}${profit.toLocaleString()}ì›
                        </span>
                    </div>
                    <div class="result-item">
                        <strong>ìˆ˜ìµë¥ :</strong>
                        <span class="value ${profitRate >= 0 ? 'positive' : 'negative'}">
                            ${profitRate >= 0 ? '+' : ''}${profitRate.toFixed(2)}%
                        </span>
                    </div>
                    <div class="result-item">
                        <strong>ì—°í™˜ì‚° ìˆ˜ìµë¥ :</strong>
                        <span class="value ${annualRate >= 0 ? 'positive' : 'negative'}">
                            ${annualRate >= 0 ? '+' : ''}${annualRate.toFixed(2)}%
                        </span>
                    </div>
                </div>
            `;
        });

        // í¬íŠ¸í´ë¦¬ì˜¤ ê´€ë¦¬
        let portfolio = JSON.parse(localStorage.getItem('investie_portfolio')) || [];

        // ë°ëª¨ í¬íŠ¸í´ë¦¬ì˜¤ ë°ì´í„° ì´ˆê¸°í™”
        function initDemoPortfolio() {
            const stored = localStorage.getItem('investie_portfolio');
            if (stored) {
                try {
                    const parsed = JSON.parse(stored);
                    if (Array.isArray(parsed) && parsed.length > 0) {
                        portfolio = parsed;
                        return; // ì´ë¯¸ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë°ëª¨ ë°ì´í„° ë¡œë“œí•˜ì§€ ì•ŠìŒ
                    }
                } catch (e) {
                    console.error('í¬íŠ¸í´ë¦¬ì˜¤ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', e);
                }
            }
            
            // í¬íŠ¸í´ë¦¬ì˜¤ê°€ ë¹„ì–´ìˆìœ¼ë©´ ë°ëª¨ ë°ì´í„° ë¡œë“œ
            if (portfolio.length === 0) {
                const demoPortfolio = [
                    { name: 'JNJ', buyPrice: 145000, quantity: 5, currentPrice: 152000 },
                    { name: 'PFE', buyPrice: 38000, quantity: 10, currentPrice: 39500 },
                    { name: 'ABBV', buyPrice: 125000, quantity: 8, currentPrice: 132000 },
                    { name: 'TDOC', buyPrice: 25000, quantity: 20, currentPrice: 26500 },
                    { name: 'CVS', buyPrice: 75000, quantity: 6, currentPrice: 78000 },
                    { name: 'BIIB', buyPrice: 280000, quantity: 3, currentPrice: 295000 },
                    { name: 'NVS', buyPrice: 95000, quantity: 7, currentPrice: 98000 },
                    { name: 'LLY', buyPrice: 420000, quantity: 2, currentPrice: 445000 },
                    { name: 'MRK', buyPrice: 98000, quantity: 5, currentPrice: 102000 },
                    { name: 'GSK', buyPrice: 45000, quantity: 12, currentPrice: 47000 }
                ];
                
                portfolio = demoPortfolio;
                localStorage.setItem('investie_portfolio', JSON.stringify(portfolio));
                console.log('ë°ëª¨ í¬íŠ¸í´ë¦¬ì˜¤ ë¡œë“œ ì™„ë£Œ:', portfolio.length, 'ê°œ ì¢…ëª©');
            }
        }

        function renderPortfolio() {
            const portfolioList = document.getElementById('portfolioList');
            if (portfolio.length === 0) {
                portfolioList.innerHTML = `
                    <p style="text-align: center; color: #666; padding: 20px;">í¬íŠ¸í´ë¦¬ì˜¤ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="initDemoPortfolio(); renderPortfolio();" class="btn" style="background: #667eea; color: white; padding: 12px 24px; border-radius: 8px; border: none; cursor: pointer; font-size: 1em; font-weight: 600;">
                            ğŸ¯ ë°ëª¨ í¬íŠ¸í´ë¦¬ì˜¤ ë¡œë“œí•˜ê¸°
                        </button>
                    </div>
                `;
                return;
            }

            portfolioList.innerHTML = portfolio.map((item, index) => {
                const totalBuy = item.buyPrice * item.quantity;
                const totalCurrent = item.currentPrice * item.quantity;
                const profit = totalCurrent - totalBuy;
                const profitRate = ((totalCurrent - totalBuy) / totalBuy) * 100;

                return `
                    <div class="portfolio-item">
                        <div class="portfolio-item-header">
                            <h3>${item.name}</h3>
                            <button class="delete-btn" onclick="deletePortfolio(${index})">ì‚­ì œ</button>
                        </div>
                        <div class="portfolio-stats">
                            <div class="stat-box">
                                <div class="label">ë§¤ìˆ˜ ê°€ê²©</div>
                                <div class="value">${item.buyPrice.toLocaleString()}ì›</div>
                            </div>
                            <div class="stat-box">
                                <div class="label">í˜„ì¬ ê°€ê²©</div>
                                <div class="value">${item.currentPrice.toLocaleString()}ì›</div>
                            </div>
                            <div class="stat-box">
                                <div class="label">ìˆ˜ëŸ‰</div>
                                <div class="value">${item.quantity}ì£¼</div>
                            </div>
                            <div class="stat-box">
                                <div class="label">ì†ìµ</div>
                                <div class="value ${profit >= 0 ? 'positive' : 'negative'}">
                                    ${profit >= 0 ? '+' : ''}${profit.toLocaleString()}ì›
                                </div>
                            </div>
                            <div class="stat-box">
                                <div class="label">ìˆ˜ìµë¥ </div>
                                <div class="value ${profitRate >= 0 ? 'positive' : 'negative'}">
                                    ${profitRate >= 0 ? '+' : ''}${profitRate.toFixed(2)}%
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // ì „ì²´ í¬íŠ¸í´ë¦¬ì˜¤ ìš”ì•½
            const totalBuy = portfolio.reduce((sum, item) => sum + (item.buyPrice * item.quantity), 0);
            const totalCurrent = portfolio.reduce((sum, item) => sum + (item.currentPrice * item.quantity), 0);
            const totalProfit = totalCurrent - totalBuy;
            const totalProfitRate = ((totalCurrent - totalBuy) / totalBuy) * 100;

            portfolioList.innerHTML += `
                <div class="portfolio-item" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-left: 4px solid white;">
                    <h3 style="color: white; margin-bottom: 15px;">ì „ì²´ í¬íŠ¸í´ë¦¬ì˜¤ ìš”ì•½</h3>
                    <div class="portfolio-stats">
                        <div class="stat-box" style="background: rgba(255,255,255,0.2);">
                            <div class="label" style="color: rgba(255,255,255,0.9);">ì´ íˆ¬ìê¸ˆì•¡</div>
                            <div class="value" style="color: white;">${totalBuy.toLocaleString()}ì›</div>
                        </div>
                        <div class="stat-box" style="background: rgba(255,255,255,0.2);">
                            <div class="label" style="color: rgba(255,255,255,0.9);">ì´ í˜„ì¬ê°€ì¹˜</div>
                            <div class="value" style="color: white;">${totalCurrent.toLocaleString()}ì›</div>
                        </div>
                        <div class="stat-box" style="background: rgba(255,255,255,0.2);">
                            <div class="label" style="color: rgba(255,255,255,0.9);">ì´ ì†ìµ</div>
                            <div class="value" style="color: ${totalProfit >= 0 ? '#90EE90' : '#FFB6C1'};">${totalProfit >= 0 ? '+' : ''}${totalProfit.toLocaleString()}ì›</div>
                        </div>
                        <div class="stat-box" style="background: rgba(255,255,255,0.2);">
                            <div class="label" style="color: rgba(255,255,255,0.9);">ì´ ìˆ˜ìµë¥ </div>
                            <div class="value" style="color: ${totalProfitRate >= 0 ? '#90EE90' : '#FFB6C1'};">${totalProfitRate >= 0 ? '+' : ''}${totalProfitRate.toFixed(2)}%</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function deletePortfolio(index) {
            portfolio.splice(index, 1);
            localStorage.setItem('investie_portfolio', JSON.stringify(portfolio));
            renderPortfolio();
        }

        function editPortfolio(index) {
            const item = portfolio[index];
            document.getElementById('portfolioName').value = item.name;
            document.getElementById('portfolioBuyPrice').value = item.buyPrice;
            document.getElementById('portfolioQuantity').value = item.quantity;
            document.getElementById('portfolioCurrentPrice').value = item.currentPrice;
            
            // ì‚­ì œí•˜ê³  ìƒˆë¡œ ì¶”ê°€í•˜ëŠ” ë°©ì‹
            portfolio.splice(index, 1);
            localStorage.setItem('investie_portfolio', JSON.stringify(portfolio));
            renderPortfolio();
            
            document.getElementById('portfolioSubmitBtn').textContent = 'ìˆ˜ì • ì™„ë£Œ';
            document.getElementById('portfolioSubmitBtn').onclick = function() {
                document.getElementById('portfolioForm').dispatchEvent(new Event('submit'));
                document.getElementById('portfolioSubmitBtn').textContent = 'í¬íŠ¸í´ë¦¬ì˜¤ì— ì¶”ê°€';
                document.getElementById('portfolioSubmitBtn').onclick = null;
            };
        }

        let currentFilter = 'all';
        let currentSort = 'name';

        function sortPortfolio(sortBy) {
            currentSort = sortBy;
            const sorted = [...portfolio].sort((a, b) => {
                const totalA = a.buyPrice * a.quantity;
                const totalB = b.buyPrice * b.quantity;
                const currentA = a.currentPrice * a.quantity;
                const currentB = b.currentPrice * b.quantity;
                const profitA = currentA - totalA;
                const profitB = currentB - totalB;
                const rateA = (profitA / totalA) * 100;
                const rateB = (profitB / totalB) * 100;

                switch(sortBy) {
                    case 'name':
                        return a.name.localeCompare(b.name);
                    case 'profit':
                        return rateB - rateA;
                    case 'profitAmount':
                        return profitB - profitA;
                    case 'value':
                        return currentB - currentA;
                    default:
                        return 0;
                }
            });
            displayFilteredPortfolio(sorted);
        }

        function filterPortfolio(filterBy) {
            currentFilter = filterBy;
            let filtered = portfolio;
            
            if (filterBy === 'profit') {
                filtered = portfolio.filter(item => {
                    const totalBuy = item.buyPrice * item.quantity;
                    const totalCurrent = item.currentPrice * item.quantity;
                    return totalCurrent > totalBuy;
                });
            } else if (filterBy === 'loss') {
                filtered = portfolio.filter(item => {
                    const totalBuy = item.buyPrice * item.quantity;
                    const totalCurrent = item.currentPrice * item.quantity;
                    return totalCurrent < totalBuy;
                });
            }
            
            // ì •ë ¬ ì ìš©
            if (currentSort !== 'name') {
                filtered = [...filtered].sort((a, b) => {
                    const totalA = a.buyPrice * a.quantity;
                    const totalB = b.buyPrice * b.quantity;
                    const currentA = a.currentPrice * a.quantity;
                    const currentB = b.currentPrice * b.quantity;
                    const profitA = currentA - totalA;
                    const profitB = currentB - totalB;
                    const rateA = (profitA / totalA) * 100;
                    const rateB = (profitB / totalB) * 100;

                    switch(currentSort) {
                        case 'profit':
                            return rateB - rateA;
                        case 'profitAmount':
                            return profitB - profitA;
                        case 'value':
                            return currentB - currentA;
                        default:
                            return 0;
                    }
                });
            }
            
            displayFilteredPortfolio(filtered);
        }

        function displayFilteredPortfolio(filteredPortfolio) {
            const portfolioList = document.getElementById('portfolioList');
            if (filteredPortfolio.length === 0) {
                portfolioList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">í‘œì‹œí•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            portfolioList.innerHTML = filteredPortfolio.map((item, displayIndex) => {
                const originalIndex = portfolio.findIndex(p => p.name === item.name && p.buyPrice === item.buyPrice);
                const index = originalIndex >= 0 ? originalIndex : displayIndex;
                const totalBuy = item.buyPrice * item.quantity;
                const totalCurrent = item.currentPrice * item.quantity;
                const profit = totalCurrent - totalBuy;
                const profitRate = ((totalCurrent - totalBuy) / totalBuy) * 100;

                return `
                    <div class="portfolio-item">
                        <div class="portfolio-item-header">
                            <h3>${item.name}</h3>
                            <div style="display: flex; gap: 5px;">
                                <button class="delete-btn" onclick="editPortfolio(${index})" style="background: #17a2b8;">ìˆ˜ì •</button>
                                <button class="delete-btn" onclick="deletePortfolio(${index})">ì‚­ì œ</button>
                            </div>
                        </div>
                        <div class="portfolio-stats">
                            <div class="stat-box">
                                <div class="label">ë§¤ìˆ˜ ê°€ê²©</div>
                                <div class="value">${item.buyPrice.toLocaleString()}ì›</div>
                            </div>
                            <div class="stat-box">
                                <div class="label">í˜„ì¬ ê°€ê²©</div>
                                <div class="value">${item.currentPrice.toLocaleString()}ì›</div>
                            </div>
                            <div class="stat-box">
                                <div class="label">ìˆ˜ëŸ‰</div>
                                <div class="value">${item.quantity}ì£¼</div>
                            </div>
                            <div class="stat-box">
                                <div class="label">ì†ìµ</div>
                                <div class="value ${profit >= 0 ? 'positive' : 'negative'}">
                                    ${profit >= 0 ? '+' : ''}${profit.toLocaleString()}ì›
                                </div>
                            </div>
                            <div class="stat-box">
                                <div class="label">ìˆ˜ìµë¥ </div>
                                <div class="value ${profitRate >= 0 ? 'positive' : 'negative'}">
                                    ${profitRate >= 0 ? '+' : ''}${profitRate.toFixed(2)}%
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // ì „ì²´ ìš”ì•½ (í•„í„°ë§ëœ í•­ëª© ê¸°ì¤€)
            const totalBuy = filteredPortfolio.reduce((sum, item) => sum + (item.buyPrice * item.quantity), 0);
            const totalCurrent = filteredPortfolio.reduce((sum, item) => sum + (item.currentPrice * item.quantity), 0);
            const totalProfit = totalCurrent - totalBuy;
            const totalProfitRate = totalBuy > 0 ? ((totalCurrent - totalBuy) / totalBuy) * 100 : 0;

            portfolioList.innerHTML += `
                <div class="portfolio-item" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-left: 4px solid white;">
                    <h3 style="color: white; margin-bottom: 15px;">${currentFilter === 'all' ? 'ì „ì²´' : currentFilter === 'profit' ? 'ìˆ˜ìµ' : 'ì†ì‹¤'} í¬íŠ¸í´ë¦¬ì˜¤ ìš”ì•½</h3>
                    <div class="portfolio-stats">
                        <div class="stat-box" style="background: rgba(255,255,255,0.2);">
                            <div class="label" style="color: rgba(255,255,255,0.9);">ì´ íˆ¬ìê¸ˆì•¡</div>
                            <div class="value" style="color: white;">${totalBuy.toLocaleString()}ì›</div>
                        </div>
                        <div class="stat-box" style="background: rgba(255,255,255,0.2);">
                            <div class="label" style="color: rgba(255,255,255,0.9);">ì´ í˜„ì¬ê°€ì¹˜</div>
                            <div class="value" style="color: white;">${totalCurrent.toLocaleString()}ì›</div>
                        </div>
                        <div class="stat-box" style="background: rgba(255,255,255,0.2);">
                            <div class="label" style="color: rgba(255,255,255,0.9);">ì´ ì†ìµ</div>
                            <div class="value" style="color: ${totalProfit >= 0 ? '#90EE90' : '#FFB6C1'};">${totalProfit >= 0 ? '+' : ''}${totalProfit.toLocaleString()}ì›</div>
                        </div>
                        <div class="stat-box" style="background: rgba(255,255,255,0.2);">
                            <div class="label" style="color: rgba(255,255,255,0.9);">ì´ ìˆ˜ìµë¥ </div>
                            <div class="value" style="color: ${totalProfitRate >= 0 ? '#90EE90' : '#FFB6C1'};">${totalProfitRate >= 0 ? '+' : ''}${totalProfitRate.toFixed(2)}%</div>
                        </div>
                    </div>
                </div>
            `;
        }

        async function autoFetchPrice() {
            const name = document.getElementById('portfolioName').value.trim();
            if (!name) {
                alert('ì¢…ëª©ëª…ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì‹¬ë³¼ ì¶”ì¶œ (ê´„í˜¸ ì•ˆì˜ ì‹¬ë³¼ ë˜ëŠ” ì „ì²´ ì´ë¦„)
            const symbolMatch = name.match(/\(([A-Z]+)\)/) || name.match(/\b([A-Z]{2,5})\b/);
            const symbol = symbolMatch ? symbolMatch[1] : name.split(' ')[0].toUpperCase();
            
            const priceInput = document.getElementById('portfolioCurrentPrice');
            priceInput.disabled = true;
            priceInput.value = 'ì¡°íšŒ ì¤‘...';
            
            try {
                const stockData = await fetchStockPrice(symbol);
                if (stockData && stockData.price) {
                    // ë‹¬ëŸ¬ë¥¼ ì›í™”ë¡œ ë³€í™˜ (ëŒ€ëµ 1300ì› ê¸°ì¤€)
                    const priceInKRW = stockData.price * 1300;
                    priceInput.value = Math.round(priceInKRW);
                    alert(`í˜„ì¬ ê°€ê²©: $${stockData.price.toFixed(2)} (ì•½ ${Math.round(priceInKRW).toLocaleString()}ì›)`);
                } else {
                    throw new Error('ê°€ê²© ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                alert('ê°€ê²© ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                priceInput.value = '';
            } finally {
                priceInput.disabled = false;
            }
        }

        async function updateAllPrices() {
            if (portfolio.length === 0) {
                alert('í¬íŠ¸í´ë¦¬ì˜¤ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (!confirm('ëª¨ë“  ì¢…ëª©ì˜ í˜„ì¬ ê°€ê²©ì„ ì—…ë°ì´íŠ¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            const updateBtn = event.target;
            updateBtn.disabled = true;
            updateBtn.textContent = 'ì—…ë°ì´íŠ¸ ì¤‘...';
            
            for (let i = 0; i < portfolio.length; i++) {
                const item = portfolio[i];
                const symbolMatch = item.name.match(/\(([A-Z]+)\)/) || item.name.match(/\b([A-Z]{2,5})\b/);
                const symbol = symbolMatch ? symbolMatch[1] : item.name.split(' ')[0].toUpperCase();
                
                try {
                    const stockData = await fetchStockPrice(symbol);
                    if (stockData && stockData.price) {
                        const priceInKRW = stockData.price * 1300;
                        portfolio[i].currentPrice = Math.round(priceInKRW);
                    }
                } catch (error) {
                    console.log(`${item.name} ê°€ê²© ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:`, error);
                }
                
                // API í˜¸ì¶œ ì œí•œì„ ìœ„í•œ ì§€ì—°
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            localStorage.setItem('investie_portfolio', JSON.stringify(portfolio));
            renderPortfolio();
            
            updateBtn.disabled = false;
            updateBtn.textContent = 'ğŸ”„ ì „ì²´ ê°€ê²© ì—…ë°ì´íŠ¸';
            alert('ê°€ê²© ì—…ë°ì´íŠ¸ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        document.getElementById('portfolioForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('portfolioName').value;
            const buyPrice = parseFloat(document.getElementById('portfolioBuyPrice').value);
            const quantity = parseFloat(document.getElementById('portfolioQuantity').value);
            let currentPrice = parseFloat(document.getElementById('portfolioCurrentPrice').value);

            // í˜„ì¬ ê°€ê²©ì´ ì—†ìœ¼ë©´ ìë™ ì¡°íšŒ ì‹œë„ (ê°„ë‹¨í•œ ì˜ˆì‹œ)
            if (!currentPrice || currentPrice === 0) {
                currentPrice = buyPrice; // ê¸°ë³¸ê°’ìœ¼ë¡œ ë§¤ìˆ˜ ê°€ê²© ì‚¬ìš©
            }

            portfolio.push({ name, buyPrice, quantity, currentPrice });
            localStorage.setItem('investie_portfolio', JSON.stringify(portfolio));
            
            document.getElementById('portfolioForm').reset();
            renderPortfolio();
        });

        // ì¦ê²¨ì°¾ê¸° ê´€ë¦¬
        let favoriteStocks = JSON.parse(localStorage.getItem('investie_favorites')) || [];
        
        function loadFavorites() {
            const favoriteDiv = document.getElementById('favoriteStocks');
            if (favoriteStocks.length === 0) {
                favoriteDiv.innerHTML = '<p style="color: #666; font-size: 0.9em;">ì¦ê²¨ì°¾ê¸° ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            favoriteDiv.innerHTML = favoriteStocks.map(symbol => `
                <button class="btn" onclick="quickStockLookup('${symbol}')" style="background: #ffc107; color: #333;">
                    ${symbol} â­
                </button>
            `).join('');
        }

        function addToFavorites(symbol) {
            if (!favoriteStocks.includes(symbol)) {
                favoriteStocks.push(symbol);
                localStorage.setItem('investie_favorites', JSON.stringify(favoriteStocks));
                loadFavorites();
            }
        }

        function removeFromFavorites(symbol) {
            favoriteStocks = favoriteStocks.filter(s => s !== symbol);
            localStorage.setItem('investie_favorites', JSON.stringify(favoriteStocks));
            loadFavorites();
        }

        // ë¹ ë¥¸ ì¡°íšŒ
        function quickStockLookup(symbol) {
            document.getElementById('stockSymbol').value = symbol;
            document.getElementById('stockForm').dispatchEvent(new Event('submit'));
        }

        // ì£¼ì‹ ì¡°íšŒ (ì—¬ëŸ¬ ì¢…ëª© ì§€ì›)
        document.getElementById('stockForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const symbolsInput = document.getElementById('stockSymbol').value.toUpperCase().trim();
            const symbols = symbolsInput.split(',').map(s => s.trim()).filter(s => s);
            const resultDiv = document.getElementById('stockResult');
            const comparisonTable = document.getElementById('comparisonTable');
            const comparisonBody = document.getElementById('comparisonTableBody');
            
            resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div>ì£¼ì‹ ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” ì¤‘...</div>';
            comparisonTable.style.display = 'none';

            try {
                if (symbols.length === 1) {
                    // ë‹¨ì¼ ì¢…ëª© ì¡°íšŒ
                    const symbol = symbols[0];
                    const isKoreanStock = /^\d+$/.test(symbol);
                    
                    if (isKoreanStock) {
                        resultDiv.innerHTML = `
                            <div class="error">
                                í•œêµ­ ì£¼ì‹ ì¡°íšŒëŠ” ë³„ë„ APIê°€ í•„ìš”í•©ë‹ˆë‹¤. 
                                í˜„ì¬ëŠ” ë¯¸êµ­ ì£¼ì‹(JNJ, PFE, TDOC ë“±)ë§Œ ì§€ì›í•©ë‹ˆë‹¤.
                            </div>
                        `;
                        return;
                    }

                    const stockData = await fetchStockPrice(symbol);
                    
                    if (stockData && stockData.price) {
                        resultDiv.innerHTML = `
                            <div class="result-card">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h3>${symbol} ì£¼ì‹ ì •ë³´</h3>
                                    <button class="btn" onclick="addToFavorites('${symbol}')" style="background: #ffc107; padding: 8px 15px;">
                                        ${favoriteStocks.includes(symbol) ? 'â­ ì¦ê²¨ì°¾ê¸° í•´ì œ' : 'â­ ì¦ê²¨ì°¾ê¸° ì¶”ê°€'}
                                    </button>
                                </div>
                                <div class="stock-info">
                                    <div class="info-card">
                                        <div class="label">í˜„ì¬ ê°€ê²©</div>
                                        <div class="value">$${stockData.price.toFixed(2)}</div>
                                    </div>
                                    <div class="info-card">
                                        <div class="label">ì „ì¼ ëŒ€ë¹„</div>
                                        <div class="value ${stockData.change >= 0 ? 'positive' : 'negative'}">
                                            ${stockData.change >= 0 ? '+' : ''}$${stockData.change.toFixed(2)}
                                        </div>
                                    </div>
                                    <div class="info-card">
                                        <div class="label">ë³€ë™ë¥ </div>
                                        <div class="value ${stockData.changePercent >= 0 ? 'positive' : 'negative'}">
                                            ${stockData.changePercent >= 0 ? '+' : ''}${stockData.changePercent.toFixed(2)}%
                                        </div>
                                    </div>
                                </div>
                                <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px; font-size: 0.9em; color: #666;">
                                    ğŸ’¡ ì‹¤ì‹œê°„ ë°ì´í„° ì¡°íšŒê°€ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ëŸ¬ í”„ë¡ì‹œë¥¼ ì‹œë„í•˜ê³  ìˆìŠµë‹ˆë‹¤.
                                </div>
                            </div>
                        `;
                    } else {
                        throw new Error('ì£¼ì‹ ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                } else {
                    // ì—¬ëŸ¬ ì¢…ëª© ì¡°íšŒ (ë¹„êµ í…Œì´ë¸”)
                    const stockDataList = [];
                    
                    for (const symbol of symbols) {
                        try {
                            const stockData = await fetchStockPrice(symbol);
                            if (stockData && stockData.price) {
                                stockDataList.push({ symbol, ...stockData });
                            }
                        } catch (error) {
                            console.log(`${symbol} ì¡°íšŒ ì‹¤íŒ¨:`, error);
                        }
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                    
                    if (stockDataList.length > 0) {
                        resultDiv.innerHTML = `
                            <div class="result-card">
                                <h3>${stockDataList.length}ê°œ ì¢…ëª© ì¡°íšŒ ì™„ë£Œ</h3>
                                <p style="color: #666;">ì•„ë˜ ë¹„êµ í…Œì´ë¸”ì„ í™•ì¸í•˜ì„¸ìš”.</p>
                            </div>
                        `;
                        
                        comparisonTable.style.display = 'block';
                        comparisonBody.innerHTML = stockDataList.map(data => `
                            <tr style="border-bottom: 1px solid #e0e0e0;">
                                <td style="padding: 12px; font-weight: 600;">${data.symbol}</td>
                                <td style="padding: 12px; text-align: right;">$${data.price.toFixed(2)}</td>
                                <td style="padding: 12px; text-align: right; color: ${data.change >= 0 ? '#28a745' : '#dc3545'};">
                                    ${data.change >= 0 ? '+' : ''}$${data.change.toFixed(2)}
                                </td>
                                <td style="padding: 12px; text-align: right; color: ${data.changePercent >= 0 ? '#28a745' : '#dc3545'};">
                                    ${data.changePercent >= 0 ? '+' : ''}${data.changePercent.toFixed(2)}%
                                </td>
                                <td style="padding: 12px; text-align: center;">
                                    <button class="btn" onclick="addToFavorites('${data.symbol}')" style="background: #ffc107; padding: 5px 10px; font-size: 0.85em;">
                                        ${favoriteStocks.includes(data.symbol) ? 'â­' : 'â˜†'}
                                    </button>
                                </td>
                            </tr>
                        `).join('');
                    } else {
                        throw new Error('ì£¼ì‹ ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ì£¼ì‹ ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. 
                        <br>ì¢…ëª© ì‹¬ë³¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”. (ì˜ˆ: JNJ, PFE, TDOC, ABBV)
                        <br><small>ì˜¤ë¥˜: ${error.message}</small>
                        <br><br>
                        <strong>ì°¸ê³ :</strong> ë¬´ë£Œ APIì˜ í•œê³„ë¡œ ì‹¤ì‹œê°„ ì¡°íšŒê°€ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        <br>ë°ëª¨ìš©ìœ¼ë¡œëŠ” ì¶”ì²œ ì¢…ëª© í˜„í™©ì„ ì°¸ê³ í•´ì£¼ì„¸ìš”.
                    </div>
                `;
            }
        });

        // ì¦ê²¨ì°¾ê¸° ì´ˆê¸° ë¡œë“œ
        loadFavorites();

        // í™˜ìœ¨ ì¡°íšŒ
        document.getElementById('exchangeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const from = document.getElementById('fromCurrency').value;
            const to = document.getElementById('toCurrency').value;
            const amount = parseFloat(document.getElementById('exchangeAmount').value);
            const resultDiv = document.getElementById('exchangeResult');
            
            resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div>í™˜ìœ¨ì„ ì¡°íšŒí•˜ëŠ” ì¤‘...</div>';

            try {
                // ExchangeRate-API ì‚¬ìš© (ë¬´ë£Œ)
                const response = await fetch(`https://api.exchangerate-api.com/v4/latest/${from}`);
                const data = await response.json();
                
                if (data.rates && data.rates[to]) {
                    const rate = data.rates[to];
                    const converted = amount * rate;
                    
                    resultDiv.innerHTML = `
                        <div class="result-card">
                            <h3>í™˜ìœ¨ ì •ë³´</h3>
                            <div class="result-item">
                                <strong>ê¸°ì¤€ í†µí™”:</strong>
                                <span class="value">${from}</span>
                            </div>
                            <div class="result-item">
                                <strong>ë³€í™˜ í†µí™”:</strong>
                                <span class="value">${to}</span>
                            </div>
                            <div class="result-item">
                                <strong>í™˜ìœ¨ (1 ${from} = ${to}):</strong>
                                <span class="value">${rate.toFixed(4)}</span>
                            </div>
                            <div class="result-item">
                                <strong>${amount.toLocaleString()} ${from} =</strong>
                                <span class="value">${converted.toLocaleString()} ${to}</span>
                            </div>
                            <div class="result-item">
                                <strong>ê¸°ì¤€ì¼:</strong>
                                <span class="value">${new Date(data.date).toLocaleDateString('ko-KR')}</span>
                            </div>
                        </div>
                    `;
                } else {
                    throw new Error('í™˜ìœ¨ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        í™˜ìœ¨ ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                        <br><small>ì˜¤ë¥˜: ${error.message}</small>
                    </div>
                `;
            }
        });

        // í¬íŠ¸í´ë¦¬ì˜¤ ë°ëª¨ ë°ì´í„° ì´ˆê¸°í™”
        initDemoPortfolio();
        
        // í¬íŠ¸í´ë¦¬ì˜¤ ì´ˆê¸° ë Œë”ë§
        renderPortfolio();

        // ì¶”ì²œ ì¢…ëª© ëª©ë¡ (í™•ì¥)
        const recommendedStocks = [
            { symbol: 'JNJ', name: 'ì¡´ìŠ¨ì•¤ì¡´ìŠ¨' },
            { symbol: 'PFE', name: 'í™”ì´ì' },
            { symbol: 'ABBV', name: 'ì• ë¸Œë¹„' },
            { symbol: 'TDOC', name: 'í…”ë¼ë…' },
            { symbol: 'CVS', name: 'CVS í—¬ìŠ¤' },
            { symbol: 'BIIB', name: 'ë°”ì´ì˜¤ì  ' },
            { symbol: 'NVS', name: 'ë…¸ë°”í‹°ìŠ¤' },
            { symbol: 'LLY', name: 'ì—˜ë¦¬ë¦´ë¦¬' },
            { symbol: 'MRK', name: 'ë¨¸í¬' },
            { symbol: 'GSK', name: 'ê¸€ë½ì†ŒìŠ¤ë¯¸ìŠ¤í´ë¼ì¸' },
            { symbol: 'TMO', name: 'ì¨ëª¨í”¼ì…”' },
            { symbol: 'DHR', name: 'ë‹¤ë‚˜í—ˆ' },
            { symbol: 'BMY', name: 'ë¸Œë¦¬ìŠ¤í†¨ë§ˆì´ì–´ìŠ¤ìŠ¤í€´ë¸Œ' },
            { symbol: 'AMGN', name: 'ì•°ì  ' },
            { symbol: 'GILD', name: 'ê¸¸ë¦¬ì–´ë“œ' },
            { symbol: 'REGN', name: 'ë¦¬ì œë„ˆë¡ ' },
            { symbol: 'VRTX', name: 'ë²„í…ìŠ¤' },
            { symbol: 'ALNY', name: 'ì•Œë‹ˆëŒ' },
            { symbol: 'IONS', name: 'ì•„ì´ì˜¤ë‹ˆìŠ¤' },
            { symbol: 'SGMO', name: 'ìƒê°€ëª¨' }
        ];

        // ê°€ê²© íˆìŠ¤í† ë¦¬ ì €ì¥ (localStorage)
        function savePriceHistory(symbol, price) {
            const key = `stock_history_${symbol}`;
            let history = JSON.parse(localStorage.getItem(key) || '[]');
            const now = Date.now();
            
            history.push({ price: price, timestamp: now });
            
            // ìµœê·¼ 20ê°œ ë°ì´í„°ë§Œ ìœ ì§€
            if (history.length > 20) {
                history = history.slice(-20);
            }
            
            localStorage.setItem(key, JSON.stringify(history));
        }

        // ê°€ê²© íˆìŠ¤í† ë¦¬ ê°€ì ¸ì˜¤ê¸°
        function getPriceHistory(symbol) {
            const key = `stock_history_${symbol}`;
            return JSON.parse(localStorage.getItem(key) || '[]');
        }

        // ê°„ë‹¨í•œ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawChart(canvasId, prices) {
            const canvas = document.getElementById(canvasId);
            if (!canvas || prices.length < 2) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = canvas.offsetHeight;
            
            ctx.clearRect(0, 0, width, height);
            
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);
            const range = maxPrice - minPrice || 1;
            const padding = 10;
            
            ctx.strokeStyle = prices[prices.length - 1] >= prices[0] ? '#28a745' : '#dc3545';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            prices.forEach((price, index) => {
                const x = padding + (index / (prices.length - 1)) * (width - padding * 2);
                const y = height - padding - ((price - minPrice) / range) * (height - padding * 2);
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
        }

        // ì£¼ì‹ ì •ë³´ ì¡°íšŒ í•¨ìˆ˜ (ì—¬ëŸ¬ í”„ë¡ì‹œ ì‹œë„)
        async function fetchStockPrice(symbol) {
            // ì—¬ëŸ¬ í”„ë¡ì‹œ ì˜µì…˜
            const proxyOptions = [
                `https://api.allorigins.win/get?url=${encodeURIComponent(`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}`)}`,
                `https://cors-anywhere.herokuapp.com/https://query1.finance.yahoo.com/v8/finance/chart/${symbol}`,
                `https://api.codetabs.com/v1/proxy?quest=https://query1.finance.yahoo.com/v8/finance/chart/${symbol}`
            ];

            for (const proxyUrl of proxyOptions) {
                try {
                    const response = await fetch(proxyUrl, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json'
                        }
                    });
                    
                    let data;
                    if (proxyUrl.includes('allorigins.win')) {
                        data = await response.json();
                        if (data.contents) {
                            data = JSON.parse(data.contents);
                        } else {
                            continue;
                        }
                    } else {
                        data = await response.json();
                    }
                    
                    const quote = data.chart?.result?.[0]?.meta;
                    
                    if (quote) {
                        const price = quote.regularMarketPrice || quote.previousClose;
                        const change = (quote.regularMarketPrice || quote.previousClose) - quote.previousClose;
                        const changePercent = (change / quote.previousClose) * 100;
                        
                        // ê°€ê²© íˆìŠ¤í† ë¦¬ ì €ì¥
                        savePriceHistory(symbol, price);
                        
                        return {
                            price: price,
                            change: change,
                            changePercent: changePercent
                        };
                    }
                } catch (error) {
                    console.error(`Proxy failed: ${proxyUrl}`, error);
                    continue; // ë‹¤ìŒ í”„ë¡ì‹œ ì‹œë„
                }
            }

            // ëª¨ë“  í”„ë¡ì‹œ ì‹¤íŒ¨ ì‹œ ì˜ˆì‹œ ë°ì´í„° ë°˜í™˜ (ë°ëª¨ìš©)
            console.warn(`All proxies failed for ${symbol}, using demo data`);
            const demoPrice = 100 + Math.random() * 50;
            savePriceHistory(symbol, demoPrice);
            return {
                price: demoPrice,
                change: (Math.random() - 0.5) * 5,
                changePercent: (Math.random() - 0.5) * 5
            };
        }

        // ì¶”ì²œ ì¢…ëª© í˜„í™© ìë™ ë¡œë“œ
        async function loadRecommendedStocks() {
            const stocksDiv = document.getElementById('recommendedStocks');
            stocksDiv.innerHTML = '<div class="loading"><div class="spinner"></div>ì£¼ì‹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';

            const stockPromises = recommendedStocks.map(async (stock) => {
                const data = await fetchStockPrice(stock.symbol);
                return { ...stock, ...data };
            });

            const stocksData = await Promise.all(stockPromises);

            // ì‹œì¥ ê°œìš” ì—…ë°ì´íŠ¸
            updateMarketOverview(stocksData);

            // íˆ¬ì ê³„ì‚°ê¸° íƒ­ìš©: ê°„ë‹¨í•œ ì‹œì¥ í˜„í™© ìš”ì•½
            stocksDiv.innerHTML = stocksData.map((stock, index) => {
                if (stock.price && stock.price > 0) {
                    const history = getPriceHistory(stock.symbol);
                    const prices = history.map(h => h.price);
                    const chartId = `chart_${stock.symbol}`;
                    
                    // ë³€ë™ì„± ê³„ì‚° (ê°„ë‹¨í•œ í‘œì¤€í¸ì°¨)
                    const volatility = calculateVolatility(prices);
                    const trend = getTrend(prices);
                    
                    // ì°¨íŠ¸ë¥¼ ê·¸ë¦¬ê¸° ìœ„í•´ ì•½ê°„ì˜ ì§€ì—°
                    setTimeout(() => {
                        drawChart(chartId, prices);
                    }, 100);
                    
                    return `
                        <div class="stock-card">
                            <div class="symbol">${stock.symbol}</div>
                            <div class="name">${stock.name}</div>
                            <div class="price">$${stock.price.toFixed(2)}</div>
                            <div class="change ${stock.change >= 0 ? 'positive' : 'negative'}">
                                ${stock.change >= 0 ? '+' : ''}$${stock.change.toFixed(2)} 
                                (${stock.change >= 0 ? '+' : ''}${stock.changePercent.toFixed(2)}%)
                            </div>
                            <div class="stock-chart">
                                <canvas id="${chartId}" class="chart-canvas"></canvas>
                            </div>
                            <div style="margin-top: 10px; font-size: 0.85em; color: #666;">
                                ${trend === 'up' ? 'ğŸ“ˆ ìƒìŠ¹ ì¶”ì„¸' : trend === 'down' ? 'ğŸ“‰ í•˜ë½ ì¶”ì„¸' : 'â¡ï¸ íš¡ë³´'}
                                ${volatility > 0 ? ` | ë³€ë™ì„±: ${volatility.toFixed(1)}%` : ''}
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="stock-card">
                            <div class="symbol">${stock.symbol}</div>
                            <div class="name">${stock.name}</div>
                            <div class="price" style="color: #999;">ì¡°íšŒ ì‹¤íŒ¨</div>
                        </div>
                    `;
                }
            }).join('');
            
            // ì¡°íšŒ ì‹¤íŒ¨í•œ ì¢…ëª©ì´ ìˆìœ¼ë©´ ì•ˆë‚´ ë©”ì‹œì§€
            const failedCount = stocksData.filter(s => !s.price || s.price <= 0).length;
            if (failedCount > 0) {
                stocksDiv.innerHTML += `
                    <div style="grid-column: 1 / -1; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107; margin-top: 10px;">
                        <strong>âš ï¸ ì°¸ê³ :</strong> ${failedCount}ê°œ ì¢…ëª©ì˜ ì‹¤ì‹œê°„ ì¡°íšŒê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. 
                        ë¬´ë£Œ APIì˜ í•œê³„ë¡œ ì¸í•´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
                        ë°ëª¨ìš©ìœ¼ë¡œëŠ” ìˆ˜ë™ìœ¼ë¡œ ê°€ê²©ì„ ì…ë ¥í•˜ê±°ë‚˜ ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
                    </div>
                `;
            }

            // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('ko-KR');
        }

        // ì‹œì¥ ê°œìš” ì—…ë°ì´íŠ¸
        function updateMarketOverview(stocksData) {
            const validStocks = stocksData.filter(s => s.price && s.price > 0);
            if (validStocks.length === 0) {
                document.getElementById('marketOverview').style.display = 'none';
                return;
            }

            document.getElementById('marketOverview').style.display = 'block';
            
            const avgChange = validStocks.reduce((sum, s) => sum + s.changePercent, 0) / validStocks.length;
            const gainers = validStocks.filter(s => s.changePercent > 0).length;
            const losers = validStocks.filter(s => s.changePercent < 0).length;

            document.getElementById('avgChange').textContent = `${avgChange >= 0 ? '+' : ''}${avgChange.toFixed(2)}%`;
            document.getElementById('gainers').textContent = `${gainers}ê°œ`;
            document.getElementById('losers').textContent = `${losers}ê°œ`;
        }

        // ìë™ ì—…ë°ì´íŠ¸ ì„¤ì •
        let updateInterval = null;
        
        function startAutoUpdate() {
            // ì¦‰ì‹œ ë¡œë“œ
            loadRecommendedStocks();
            
            // 30ì´ˆë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸
            if (updateInterval) {
                clearInterval(updateInterval);
            }
            
            updateInterval = setInterval(() => {
                loadRecommendedStocks();
            }, 30000); // 30ì´ˆ
        }

        // ì¶”ì²œ ì¢…ëª© ë¯¸ë¦¬ë³´ê¸° ë¡œë“œ (ì£¼ì‹ ì¡°íšŒ íƒ­ìš©)
        async function loadPreviewStocks() {
            const previewDiv = document.getElementById('previewStocks');
            if (!previewDiv) return;
            
            previewDiv.innerHTML = '<div class="loading"><div class="spinner"></div>ì£¼ì‹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';

            const stockPromises = recommendedStocks.map(async (stock) => {
                const data = await fetchStockPrice(stock.symbol);
                return { ...stock, ...data };
            });

            const stocksData = await Promise.all(stockPromises);

            // ì£¼ì‹ ì¡°íšŒ íƒ­ìš©: ìƒì„¸ ë¶„ì„ ì •ë³´ í¬í•¨
            previewDiv.innerHTML = stocksData.map((stock, index) => {
                if (stock.price && stock.price > 0) {
                    const history = getPriceHistory(stock.symbol);
                    const prices = history.map(h => h.price);
                    const chartId = `preview_chart_${stock.symbol}`;
                    
                    // ìƒì„¸ ë¶„ì„ ë°ì´í„°
                    const volatility = calculateVolatility(prices);
                    const trend = getTrend(prices);
                    const priceRange = getPriceRange(prices);
                    const riskLevel = getRiskLevel(volatility, stock.changePercent);
                    const investmentType = getInvestmentType(stock.symbol);
                    
                    // ì°¨íŠ¸ë¥¼ ê·¸ë¦¬ê¸° ìœ„í•´ ì•½ê°„ì˜ ì§€ì—°
                    setTimeout(() => {
                        drawChart(chartId, prices);
                    }, 100);
                    
                    return `
                        <div class="stock-card" style="cursor: pointer;" onclick="document.getElementById('stockSymbol').value='${stock.symbol}'; document.getElementById('stockForm').dispatchEvent(new Event('submit', {cancelable: true, bubbles: true}));">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <div class="symbol">${stock.symbol}</div>
                                <span style="background: ${riskLevel.color}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.75em;">
                                    ${riskLevel.label}
                                </span>
                            </div>
                            <div class="name">${stock.name}</div>
                            <div class="price">$${stock.price.toFixed(2)}</div>
                            <div class="change ${stock.change >= 0 ? 'positive' : 'negative'}">
                                ${stock.change >= 0 ? '+' : ''}$${stock.change.toFixed(2)} 
                                (${stock.change >= 0 ? '+' : ''}${stock.changePercent.toFixed(2)}%)
                            </div>
                            <div class="stock-chart">
                                <canvas id="${chartId}" class="chart-canvas"></canvas>
                            </div>
                            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e0e0e0; font-size: 0.85em;">
                                <div style="color: #666; margin-bottom: 5px;">
                                    <strong>íˆ¬ì ìœ í˜•:</strong> ${investmentType}
                                </div>
                                <div style="color: #666; margin-bottom: 5px;">
                                    <strong>ê°€ê²© ë²”ìœ„:</strong> $${priceRange.min.toFixed(2)} - $${priceRange.max.toFixed(2)}
                                </div>
                                <div style="color: #666;">
                                    <strong>ì¶”ì„¸:</strong> ${trend === 'up' ? 'ğŸ“ˆ ìƒìŠ¹' : trend === 'down' ? 'ğŸ“‰ í•˜ë½' : 'â¡ï¸ íš¡ë³´'}
                                    ${volatility > 0 ? ` | ë³€ë™ì„±: ${volatility.toFixed(1)}%` : ''}
                                </div>
                            </div>
                            <div style="margin-top: 10px; font-size: 0.8em; color: #667eea; text-align: center; font-weight: 600;">
                                í´ë¦­í•˜ì—¬ ìƒì„¸ ì •ë³´ ë³´ê¸° â†’
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="stock-card">
                            <div class="symbol">${stock.symbol}</div>
                            <div class="name">${stock.name}</div>
                            <div class="price" style="color: #999;">ì¡°íšŒ ì‹¤íŒ¨</div>
                            <div style="font-size: 0.8em; color: #999; margin-top: 5px;">API ì—°ê²° ë¬¸ì œ</div>
                        </div>
                    `;
                }
            }).join('');
        }

        // ë³€ë™ì„± ê³„ì‚°
        function calculateVolatility(prices) {
            if (prices.length < 2) return 0;
            const returns = [];
            for (let i = 1; i < prices.length; i++) {
                returns.push((prices[i] - prices[i-1]) / prices[i-1] * 100);
            }
            const avgReturn = returns.reduce((a, b) => a + b, 0) / returns.length;
            const variance = returns.reduce((sum, r) => sum + Math.pow(r - avgReturn, 2), 0) / returns.length;
            return Math.sqrt(variance);
        }

        // ì¶”ì„¸ ë¶„ì„
        function getTrend(prices) {
            if (prices.length < 3) return 'neutral';
            const recent = prices.slice(-3);
            if (recent[2] > recent[0]) return 'up';
            if (recent[2] < recent[0]) return 'down';
            return 'neutral';
        }

        // ê°€ê²© ë²”ìœ„
        function getPriceRange(prices) {
            if (prices.length === 0) return { min: 0, max: 0 };
            return {
                min: Math.min(...prices),
                max: Math.max(...prices)
            };
        }

        // ë¦¬ìŠ¤í¬ ë ˆë²¨
        function getRiskLevel(volatility, changePercent) {
            const riskScore = Math.abs(volatility) + Math.abs(changePercent);
            if (riskScore < 2) {
                return { label: 'ë‚®ì€ ë¦¬ìŠ¤í¬', color: '#28a745' };
            } else if (riskScore < 5) {
                return { label: 'ë³´í†µ ë¦¬ìŠ¤í¬', color: '#ffc107' };
            } else {
                return { label: 'ë†’ì€ ë¦¬ìŠ¤í¬', color: '#dc3545' };
            }
        }

        // íˆ¬ì ìœ í˜•
        function getInvestmentType(symbol) {
            const types = {
                'JNJ': 'ì•ˆì •í˜• (ëŒ€í˜• ì œì•½)',
                'PFE': 'ì•ˆì •í˜• (ëŒ€í˜• ì œì•½)',
                'CVS': 'ì•ˆì •í˜• (í—¬ìŠ¤ì¼€ì–´)',
                'NVS': 'ì•ˆì •í˜• (ëŒ€í˜• ì œì•½)',
                'ABBV': 'ì„±ì¥í˜• (ë°”ì´ì˜¤í…)',
                'TDOC': 'ì„±ì¥í˜• (ë””ì§€í„¸ í—¬ìŠ¤)',
                'BIIB': 'ê³µê²©í˜• (ë°”ì´ì˜¤í…)'
            };
            return types[symbol] || 'ì¼ë°˜';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¶”ì²œ ì¢…ëª© ìë™ ë¡œë“œ ë° ìë™ ì—…ë°ì´íŠ¸ ì‹œì‘
        startAutoUpdate();
    </script>
</body>
</html>


